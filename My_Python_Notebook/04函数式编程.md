# 函数式编程

**函数**是Python内建支持的一种封装，我们通过把大段代码拆成函数，通过一层一层的函数调用，就可以把复杂任务分解成简单的任务，这种分解可以称之为面向过程的程序设计。函数就是面向过程的程序设计的基本单元。

**函数式编程**（请注意多了一个**“式”**字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其**思想更接近数学计算**。

我们首先要搞明白**计算机（Computer）**和**计算（Compute）**的概念。

- 在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以汇编语言是最贴近计算机的语言。

- 计算则是指数学意义上的计算，越是抽象的计算，离计算机硬件越远。

对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。

归纳一下：

|  | 低级语言 | 高级语言 |
|:-:|:-:|:-:|
| 特点 | 贴近计算机 | 贴近计算（数学意义上） |
| 抽象程度 | 低 | 高 |
| 执行效率 | 高 | 低 |
| 例子 | 汇编和C | Lisp |

函数式编程就是一种**抽象程度很高的编程范式**，纯粹的函数式编程语言编写的函数**没有变量**，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为**没有副作用**。而允许使用变量的程序设计语言，由于函数内部的**变量状态不确定**，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。

函数式编程的一个特点就是，**允许把函数本身作为参数传入另一个函数，还允许返回一个函数**！

Python**仅对函数式编程提供部分支持**。由于Python允许使用变量，因此，**Python不是纯函数式编程语言**。

## 函数式编程的三大特性

1. **immutable data**<br>
变量不可变，或者说没有变量，只有常量。 函数式编程输入确定时输出就是确定的，函数内部的变量和函数外部的没有关系，不会受到外部操作的影响。

2. **first class functions**<br>
第一类函数(也称高阶函数)，意思是函数可以向变量一样用，可以像变量一样创建、修改、传递和返回。 这就允许我们把大段代码拆成函数一层层地调用，这种面向过程的写法相比循环更加直观。

3. **尾递归优化**<br>
之前一章的递归函数中已经提及过了，就是递归时返回函数本身而非表达式。 可惜Python中没有这个特性。

---

<br>

## 函数式编程的几个技术

1. **map & reduce**<br>
函数式编程最常见的技术就是对一个集合做Map和Reduce操作。这比起传统的面向过程的写法来说，在代码上要更容易阅读（不需要使用一堆for、while循环来倒腾数据，而是使用更抽象的Map函数和Reduce函数）。

2. **pipeline**<br>
这个技术的意思是把函数实例成一个一个的action，然后把一组action放到一个数组或是列表中组成一个action list，然后把数据传给这个action list，数据就像通过一个pipeline一样顺序地被各个函数所操作，最终得到我们想要的结果。

3. **recursing**<br>
递归最大的好处就简化代码，它可以把一个复杂的问题用很简单的代码描述出来。注意：递归的精髓是描述问题，而这正是函数式编程的精髓。

4. **currying**<br>
把一个函数的多个参数分解成多个函数， 然后把函数多层封装起来，每层函数都返回一个函数去接收下一个参数这样，可以简化函数的多个参数（减少函数的参数数目）。

5. **higher order function**<br>
高阶函数：所谓高阶函数就是函数当参数，把传入的函数做一个封装，然后返回这个封装函数。现象上就是函数传进传出。

对currying进行一点补充，举个例子：

```python
def pow(i, j):
    return i**j

def square(i):
    return pow(i, 2)
```

这里就是把原本平方函数`square`的参数j分解了，它返回幂函数`pow`函数，把幂次封装在里面，从而减少了求平方时所需用到的参数。

关于函数式编程的一些概念理解可以看[傻瓜函数式编程](http://www.kancloud.cn/kancloud/functional-programm-for-rest/56931)或者英文原版的[Functional Programming For The Rest of Us](http://www.defmacro.org/ramblings/fp.html)。

---

<br>

## 函数式编程的几个好处

1. **parallelization 并行**<br>
在并行环境下，各个线程之间不需要同步或互斥(变量都是内部的，不需要共享)。

2. **lazy evaluation 惰性求值**<br>
表达式不在它被绑定到变量之后就立即求值，而是在该值被取用的时候求值。

3. **determinism 确定性**<br>
输入是确定的，输出就是确定的。
